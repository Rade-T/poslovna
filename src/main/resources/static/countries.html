<!DOCTYPE html>
<html>
<head>
<script src="scripts/jquery-3.2.1.min.js"></script>
<script src="scripts/tether.min.js"></script>
<script src="scripts/bootstrap.min.js"></script>
<script src="scripts/functions.js"></script>
<link rel="stylesheet" type="text/css" href="stylesheets/design.css">
<link rel="stylesheet" href="stylesheets/bootstrap.min.css">
<meta charset="UTF-8">
<title>Države</title>
<script>
	$(document).ready(
			function() {
				$.ajax({
					url : "http://localhost:8080/api/countries/getCountries"
				}).then(
						function(data) {
							for (i = 0; i < data.length; i++) {
								newRow = "<tr><td class=\"code\">" + data[i].code + "</td>"
										+ "<td class=\"name\">" + data[i].name + "</td>"
										+ "<td><a class=\"remove\" href='/api/countries/" + data[i].id + "'>" 
										+ "<img src='images/remove.gif'/></a></td>" +
										+ "<td class=\"idCell\">" + data[i].id + "</td>"
										  "</tr>"
								$("#dataTable").append(newRow)
							}
						});
				
				$("#first").click(function(){
					goFirst();
				 });
				
				$("#last").click(function(){
					goLast();
				 });
				
				$("#next").click(function(){
					goNext();
				 });
				
				$("#prev").click(function(){
					goPrevious();
				 });
				
				$("#add").click(function(){
					//pripremamo JSON koji cemo poslati
					formData = JSON.stringify({
    	                code:$("#inputForm [name='code']").val(),
    	                name:$("#inputForm [name='name']").val(),
    	            });
					$.ajax({
						url: "/api/countries",
						type: "POST",
						data: formData,
						//saljemo json i ocekujemo json nazad
						contentType: "application/json",
						datatype: 'json',
						success: function(data) {
							newRow = "<tr><td class=\"code\">" + data.code + "</td>"
								+ "<td class=\"name\">" + data.name + "</td>"
								+ "<td><a class=\"remove\" href='/api/countries/" + data.id + "'>" 
								+ "<img src='images/remove.gif'/></a></td>" +
								+ "<td class=\"idCell\">" + data.id + "</td>"
								  "</tr>"
							$("#dataTable").append(newRow)
						  }
						});
					$('#inputModal').modal('toggle');
				});
						
			});

	$(document).on("click", "tr", function(event) {
		highlightRow(this)
	});
	
	$(document).on("click", ".remove", function(event){
		//ne salji get zahtev
		event.preventDefault(); 
		url = $(this).attr("href")
		//red koji se treba izbrisati ako je brisanje na serveru bilo uspesno
		tr_parent = $(this).closest("tr")
		$.ajax({
        	url: url,
        	type: "DELETE",
        	success: function(){
        		//ukloni i na strani 
				tr_parent.remove()
	        }
		});
	});
</script>

</head>
<body>
	<div class="formContainer">
		<ul>
			<li><a href="#" id="refresh"><img src="images/refresh.gif" /></a></li>
			<li><a href="#" id="help"><img src="images/help.gif" /></a></li>
			<li class="group-start"><a id="first"><img src="images/first.gif" /></a></li>
			<li><a id="prev"><img src="images/prev.gif" /></a></li>
			<li><a id="next"><img src="images/next.gif" /></a></li>
			<li><a id="last"><img src="images/last.gif" /></a></li>
			<li class="group-start"><a href="#inputModal" data-toggle="modal" data-target="#inputModal"><img src="images/add.gif" /></a></li>
			<li><a href="#" id="nextform"><img src="images/nextform.gif" /></a></li>
		</ul>

		<h1>Države</h1>
		<table id="dataTable" class="table">
			<tr class="header">
				<th>Oznaka</th>
				<th>Naziv</th>
				<th width="20px"></th>
			</tr>
		</table>

		<div class="panel">
			<p>
				<form>
					<input type="hidden" name="id" id="id" />
					<p>
						<label for="oznaka">Oznaka</label> <input type="text" name="code"
							id="oznaka" />
					</p>
					<p>
						<label for="naziv">Naziv</label> <input type="text" name="name"
							id="naziv" />
					</p>
					<div id="formActions">
						<input type="submit" value="Potvrda" style="margin-left: 6em" /> <a
							href="#" style="margin-left: 1em">Rollback</a>
					</div>
				</form>
			</p>
		</div>

		<div class="modal fade" id="inputModal" tabindex="-1" role="dialog">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel">Nova država</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <form id="inputForm">
		      <div class="modal-body">
					<input type="hidden" name="id" id="id" />
				<p>
					<label for="oznaka">Oznaka</label> <input type="text" name="code"
						id="oznaka" />
				</p>
				<p>
					<label for="naziv">Naziv</label> <input type="text" name="name"
						id="naziv" />
				</p>		
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Zatvori</button>
		        <button type="button" class="btn btn-primary" id="add">Potvrda</button>
		      </div>
		      </form>
		    </div>
		  </div>
		</div>
</body>
</html>