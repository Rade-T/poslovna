<html>
<head>
<meta charset="UTF-8">
<script src="scripts/jquery-3.2.1.min.js"></script>
<script src="scripts/tether.min.js"></script>
<script src="scripts/bootstrap.min.js"></script>
<script src="scripts/functions.js"></script>
<link rel="stylesheet" type="text/css" href="stylesheets/design.css">
<link rel="stylesheet" href="stylesheets/bootstrap.min.css">
<!-- <link rel="shortcut icon" type="image/png" href="images/favicon.png}"> -->
<script>
	$(document).ready(function() {
		$("#porezPickup").click(function() {
			id = $(".highlighted").find(".id").html();
			$("select").val(id);
			$('#porezModal').modal('toggle');
		});

		console.log("Krece ajax");
		$.ajax({
			url : "http://localhost:8080/Cenovnici/"})
			.then(
					function(data) {
						console.log("Uspeo")
						for (i = 0; i < data.length; i++) {
							var newRow = "<td class=\"datumPrimene\">"
							+ data[i].datumPrimene
							+ "</td>"
							+ "<td class=\"preduzece\">"
							+ data[i].preduzece
							+ "</td>"
							+ "<td><a class=\"remove\" href='/Cenovnici/" + data[i].id + "'>"
							+ "<img src='images/remove.gif'/></a></td>"
							+ +"<td class=\"idCell\">"
							+ data[i].id + "</td>"
							"</tr>"
							$("#dataTable").append(newRow)
						}
					});
		
		$("#add").click(function(){
			// pripremamo JSON koji cemo poslati
				console.log("start");
				formData = JSON.stringify({
		            datum : $("#inputForm [name='datum']").val(),
		            preduzece :$("#inputForm [name='preduzece']").val(),
		        });
				$.ajax({
					url: "http://localhost:8080/Cenovnici",
					type: "POST",
					data: formData,
					// saljemo json i ocekujemo json nazad
					contentType: "application/json",
					datatype: 'json',
					success: function(data) {
						var newRow = "<td class=\"datumPrimene\">"
						+ data.datumPrimene
						+ "</td>"
						+ "<td class=\"preduzece\">"
						+ data.preduzece
						+ "</td>"
						+ "<td><a class=\"remove\" href='/Cenovnici/" + data[i].id + "'>"
						+ "<img src='images/remove.gif'/></a></td>"
						+ +"<td class=\"idCell\">"
						+ data.id + "</td>"
						"</tr>"
						$("#dataTable").append(newRow)
					  }
					});
				$('#inputModal').modal('toggle');
				console.log("end");
		 });
		
		});
	
	function sync(item) {
		datumPrimene = item.find(".datumPrimene").html()
		id = item.find(".id").html()
		$("#datumPrimene").val(datumPrimene);
		$("#id").val(id);
	}
</script>
</head>

<body>
	<p>
	<ul>
		<li><a href="@{Cenovnici.show(" filter")}" id="search"><img
				src="images/search.gif" /></a></li>
		<li><a href="#" id="refresh"><img src="images/refresh.gif" /></a></li>
		<li><a href="#" id="pickup"><img src="images/zoom-pickup.gif" /></a></li>
		<li><a href="#" id="help"><img src="images/help.gif" /></a></li>
		<li><a id="first"><img src="images/first.gif" /></a></li>
		<li><a id="prev"><img src="images/prev.gif" /></a></li>
		<li><a id="next"><img src="images/next.gif" /></a></li>
		<li><a id="last"><img src="images/last.gif" /></a></li>
		<li><a href="#inputModal" data-toggle="modal"
			data-target="#inputModal"><img src="images/add.gif" /></a></li>
		<li><a href="@{Cenovnici.show(" remove")}" id="remove"><img
				src="images/remove.gif" /></a></li>
		<li><a href="#" id="nextform"><img src="images/nextform.gif" /></a></li>
		<li><a href="@{Cenovnici.show(" copy")}" id="copy"><img />Kopiraj
				cenovnik</a></li>
		<li><a href="@{Application.index}" id="nextform">MAIN PAGE</a></li>

	</ul>
	</p>

	<div class="container-fluid">
		<h1>Cenovnici</h1>

		<table id="dataTable">
			<tr class="header">
				<th>Datum primene</th>
				<th>Preduzece</th>
			</tr>
			<!-- #{list items:cenovnici, as:'i'} -->
			<!-- 		<tr> -->
			<!-- 			<td class="datumPrimene">${i.datumPrimene}</td> -->
			<!-- 			<td class="preduzece">${i.preduzece.naziv}</td> -->
			<!-- 			<td style="visibility: hidden; max-width: 0px" class="id">${i.id}</td> -->
			<!-- 		</tr> -->
			<!-- #{/list} -->
		</table>

		<!-- #{set 'action'} -->
		<!--     #{if mode == 'add'} -->
		<!--         @{Cenovnici.add()} -->
		<!--     #{/if} -->
		<!--     #{elseif mode == 'edit'} -->
		<!--         @{Cenovnici.edit()} -->
		<!--     #{/elseif} -->
		<!--     #{elseif mode == 'copy'} -->
		<!-- 		 @{Cenovnici.copy()} -->
		<!--  	#{/elseif} -->
		<!--     #{elseif mode == 'remove'} -->
		<!--         @{Cenovnici.delete()} -->
		<!--     #{/elseif} -->
		<!--     #{else} -->
		<!--        @{Cenovnici.filter()} -->
		<!--     #{/else} -->
		<!--   #{/set} -->

		<div class="panel">
			<p>
			<form>

				<input type="hidden" name="cenovnikId" id="cenovnikId" />

				<p>
					<label for="${field.id}">Datum primene</label> <input type="text"
						name="${field.name}" id="${field.id}" />
				</p>
				<p>
					<label for="${field.id}">Preduzece</label> <select
						name="${field.name}" id="${field.id}" /> #{list items:preduzeca,
					as:'i'}
					<option value="${i.id}">${i.naziv}</option>
					#{/list} </select>

					<button type="button" class="btn btn-info btn-sm"
						data-toggle="modal" data-target="#porezModal">...</button>
				</p>
				<p>
					<label id="procenatL" for="${field.id}">Procenat</label> <input
						type="number" name="${field.name}" id="procenat" />
				<p>
					<input type="checkbox" name="povecanje" id="povecanje">
					Povecanje</input>
				</p>
				<p>
					<input type="checkbox" name="smanjenje" id="smanjenje">
					Smanjenje</input>
				</p>

				</p>


				<div id="formActions">
					<input type="submit" value="Potvrda" style="margin-left: 6em" /> <a
						href="@{Cenovnici.show(" ")}" style="margin-left: 1em">Rollback</a>
				</div>
			</form>
			</p>
		</div>
		<div class="modal" id="inputModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Novi cenovnik</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form id="inputForm">
						<div class="modal-body">
							<input type="hidden" name="id" id="id" />
							<p>
								<label for="datumPrimene">Datum primene</label> <input type="date"
									name="code" id="datumPrimene" />
							</p>
							<p>
								<label for="preduzece">Preduzece</label> <input type="text" name="preduzece"
									id="preduzece" />
							</p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-dismiss="modal">Zatvori</button>
							<button type="button" class="btn btn-primary" id="add">Potvrda</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</body>
</html>